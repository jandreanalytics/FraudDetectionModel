<!DOCTYPE html>
<html>
<head>
    <title>Fraud Detection Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" rel="stylesheet">
    <style>
        .loading {
            position: relative;
            opacity: 0.7;
            pointer-events: none;
        }
        .loading::after {
            content: "Analyzing...";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 1rem 2rem;
            border-radius: 4px;
        }
        .history-item {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .history-item:hover {
            transform: translateX(10px);
        }
        .risk-high { border-left: 5px solid #dc3545; }
        .risk-medium { border-left: 5px solid #ffc107; }
        .risk-low { border-left: 5px solid #17a2b8; }
        .risk-none { border-left: 5px solid #28a745; }
        .pulse {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .risk-indicator {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 1rem auto;
            font-size: 2rem;
            transition: all 0.5s ease;
        }
        .alert {
            transition: all 0.3s ease;
        }
        .stats-container {
            background: rgba(0,0,0,0.05);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }
        .tips {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-dark bg-primary">
        <div class="container">
            <span class="navbar-brand mb-0 h1">Fraud Detection System</span>
            <a href="https://github.com/yourusername/fraud-detection" class="btn btn-outline-light">View on GitHub</a>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-6">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">Test Transaction</h5>
                        <form id="transactionForm">
                            <div class="mb-3">
                                <label>Amount ($)</label>
                                <input type="number" class="form-control" name="amount" step="0.01" required>
                                <div class="form-text">Try amounts like $999 or small amounts under $10</div>
                            </div>
                            <div class="mb-3">
                                <label>Time</label>
                                <input type="time" class="form-control" name="time" required value="12:00">
                                <div class="form-text">Transactions between 00:00-06:00 are considered high-risk</div>
                            </div>
                            <div class="mb-3">
                                <label>Location</label>
                                <select class="form-control" name="location" required>
                                    <option value="NY">New York</option>
                                    <option value="LA">Los Angeles</option>
                                    <option value="CH">Chicago</option>
                                    <option value="UK">United Kingdom</option>
                                    <option value="RU">Russia</option>
                                    <option value="BR">Brazil</option>
                                    <option value="CN">China</option>
                                </select>
                                <div class="form-text">Try high-risk locations like RU, UK, BR, or CN</div>
                            </div>
                            <div class="mb-3">
                                <label>Transaction Type</label>
                                <select class="form-control" name="transaction_type" required>
                                    <option value="pos">POS</option>
                                    <option value="online">Online</option>
                                    <option value="atm">ATM</option>
                                    <option value="recurring">Recurring</option>
                                </select>
                                <div class="form-text">ATM transactions at night are considered risky</div>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Analyze Transaction</button>
                        </form>
                    </div>
                </div>

                <div class="card shadow-sm mt-3">
                    <div class="card-body">
                        <h5 class="card-title">Quick Test Scenarios</h5>
                        <div class="list-group">
                            <button class="list-group-item list-group-item-action" onclick="loadScenario('safe')">
                                ‚úÖ Safe Transaction (NY, POS, $50)
                            </button>
                            <button class="list-group-item list-group-item-action" onclick="loadScenario('suspicious')">
                                ‚ö†Ô∏è Suspicious Activity (UK, Online, $999)
                            </button>
                            <button class="list-group-item list-group-item-action" onclick="loadScenario('risky')">
                                üö® High Risk (RU, ATM at night, $5)
                            </button>
                        </div>
                        <div class="tips mt-3">
                            <strong>Tips:</strong>
                            <ul>
                                <li>Try late-night ATM transactions (high risk)</li>
                                <li>Test small amounts under $10 (potential card testing)</li>
                                <li>Use locations like RU, BR, CN (high-risk regions)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div id="resultCard" class="card shadow-sm d-none mb-3">
                    <div class="card-body">
                        <h5 class="card-title">Analysis Result</h5>
                        <div id="resultContent"></div>
                        <div id="riskIndicator" class="risk-indicator"></div>
                        <div id="riskFactors" class="stats-container d-none">
                            <h6>Risk Factors:</h6>
                            <div id="riskFactorsList"></div>
                        </div>
                    </div>
                </div>

                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">Transaction History</h5>
                        <div id="historyList" class="list-group mt-3">
                            <!-- Transaction history will be added here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">About This Project</h5>
                        <p>This fraud detection system uses machine learning to analyze transactions in real-time. Features include:</p>
                        <ul>
                            <li>Real-time transaction analysis</li>
                            <li>Multiple risk factor consideration</li>
                            <li>Location-based risk assessment</li>
                            <li>Pattern recognition for fraud detection</li>
                        </ul>
                        <p>Built with Python, Flask, scikit-learn, and modern web technologies.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://fraud-detection-api-fl72.onrender.com';
        let transactionHistory = [];

        const scenarios = {
            safe: {
                amount: 75.50,
                location: 'SF',
                transaction_type: 'pos',
                merchant_category: 'retail',
                time: '14:30',
                description: 'Regular retail POS transaction during business hours'
            },
            suspicious: {
                amount: 2.50,
                location: 'RU',
                transaction_type: 'online',
                merchant_category: 'online',
                time: '03:15',
                description: 'Card testing pattern during night hours'
            },
            risky: {
                amount: 400.00,
                location: 'BR',
                transaction_type: 'atm',
                merchant_category: 'retail',
                time: '02:30',
                description: 'Late night ATM in high-risk location'
            },
            anomaly: {
                amount: 850.00,
                location: 'CN',
                transaction_type: 'pos',
                merchant_category: 'travel',
                time: '23:45',
                description: 'Location anomaly with large amount'
            }
        };

        function loadScenario(type) {
            const form = document.getElementById('transactionForm');
            const scenario = scenarios[type];
            form.amount.value = scenario.amount;
            form.location.value = scenario.location;
            form.transaction_type.value = scenario.transaction_type;
            form.time.value = scenario.time;
            
            // Add toast notification to explain the scenario
            const toast = document.createElement('div');
            toast.className = 'alert alert-info alert-dismissible fade show position-fixed bottom-0 end-0 m-3';
            toast.innerHTML = `
                <strong>Test Scenario:</strong> ${scenario.description}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 5000);
        }

        document.getElementById('transactionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            form.closest('.card').classList.add('loading');
            
            // Get current date and combine with selected time
            const now = new Date();
            const [hours, minutes] = form.time.value.split(':');
            now.setHours(parseInt(hours), parseInt(minutes), 0);
            
            const data = {
                transaction_id: Date.now(),
                timestamp: now.toISOString().slice(0, 19).replace('T', ' '),
                amount: parseFloat(form.amount.value),
                location: form.location.value,
                transaction_type: form.transaction_type.value,
                merchant_category: 'retail'
            };

            try {
                const response = await fetch(`${API_URL}/api/v1/predict`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                displayResult(result);
                addToHistory({ ...data, ...result });
            } catch (error) {
                console.error('Error:', error);
                alert('Error processing transaction');
            } finally {
                form.closest('.card').classList.remove('loading');
            }
        });

        function displayResult(result) {
            const resultCard = document.getElementById('resultCard');
            const resultContent = document.getElementById('resultContent');
            const riskIndicator = document.getElementById('riskIndicator');
            const riskFactors = document.getElementById('riskFactors');
            const riskFactorsList = document.getElementById('riskFactorsList');
            
            resultCard.classList.remove('d-none');
            resultCard.classList.add('animate__animated', 'animate__fadeIn');
            
            const riskColors = {
                high: '#dc3545',
                medium: '#ffc107',
                low: '#17a2b8',
                none: '#28a745'
            };

            const emoji = {
                high: 'üö®',
                medium: '‚ö†Ô∏è',
                low: 'üìä',
                none: '‚úÖ'
            };
            
            // Update risk indicator
            riskIndicator.style.backgroundColor = riskColors[result.fraud_level];
            riskIndicator.innerHTML = `
                <div class="text-center text-white">
                    <div style="font-size: 3rem;">${emoji[result.fraud_level]}</div>
                    <div style="font-size: 1.2rem;">${(result.fraud_probability * 100).toFixed(1)}%</div>
                </div>
            `;
            
            // Add pulse animation for high risk
            if (result.fraud_level === 'high') {
                riskIndicator.classList.add('pulse');
            } else {
                riskIndicator.classList.remove('pulse');
            }
            
            // Update content
            resultContent.innerHTML = `
                <div class="alert alert-${result.fraud_level === 'high' ? 'danger' : 
                                        result.fraud_level === 'medium' ? 'warning' : 
                                        result.fraud_level === 'low' ? 'info' : 'success'}">
                    <h4>${emoji[result.fraud_level]} Risk Level: ${result.fraud_level.toUpperCase()}</h4>
                    <p>Decision: ${result.is_fraud ? 'üö´ SUSPICIOUS' : '‚úÖ LEGITIMATE'}</p>
                </div>
            `;

            // Show risk factors if any exist
            const riskPatterns = Object.entries(result.risk_patterns)
                .filter(([_, value]) => value)
                .map(([key]) => key.replace(/_/g, ' ').toUpperCase());

            if (riskPatterns.length > 0) {
                riskFactors.classList.remove('d-none');
                riskFactorsList.innerHTML = riskPatterns
                    .map(pattern => `<div class="alert alert-warning mb-2">${pattern}</div>`)
                    .join('');
            } else {
                riskFactors.classList.add('d-none');
            }
        }

        function addToHistory(transaction) {
            transactionHistory.unshift(transaction);
            updateHistoryDisplay();
        }

        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = transactionHistory
                .slice(0, 5)
                .map(t => `
                    <div class="list-group-item history-item risk-${t.fraud_level}">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>$${t.amount.toFixed(2)}</strong> - ${t.location}
                                <small class="text-muted">(${t.transaction_type})</small>
                            </div>
                            <span class="badge bg-${t.fraud_level === 'high' ? 'danger' : 
                                                t.fraud_level === 'medium' ? 'warning' : 
                                                t.fraud_level === 'low' ? 'info' : 'success'}">
                                ${(t.fraud_probability * 100).toFixed(1)}%
                            </span>
                        </div>
                    </div>
                `).join('');
        }
    </script>
</body>
</html>
